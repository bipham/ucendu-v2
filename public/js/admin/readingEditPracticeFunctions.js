function editContentLesson(){$(".preview-lesson").addClass("hidden"),$(".btn-edit-content-lesson").addClass("hidden-class"),$(".btn-edit-quiz-lesson").addClass("hidden-class"),$(".edit-quiz-lesson").remove(),$(".edit-content-lesson").removeClass("hidden"),content_lesson_source=CKEDITOR.instances.contentLesson.getData().trim()}function editHighlightLesson(){content_lesson_source!=CKEDITOR.instances.contentLesson.getData().trim()?(content_lesson_source=CKEDITOR.instances.contentLesson.getData().trim(),$(".card-block.remove-highlight-area").html(""),$("#sandbox").html(content_lesson_source)):($(".hl-btn-content-area.remove-highlight-area").html(""),$("#sandbox .answer-highlight").each(function(){$(this).removeClass("hidden-highlight");var e=$(this)[0].classList[1].match(/\d+/);0==$(".remove-ans-"+e[0]).length&&$(".card-block.remove-highlight-area").append('<div class="remove-ans-'+e[0]+'">Remove highlight for anwser '+e[0]+': <button class="btn btn-info remove" data-removeid="'+e[0]+'">Remove</button></div>')}),content_highlight=$("#sandbox-quiz").html()),$(".edit-highlight").toggleClass("hidden"),$(".edit-content").toggleClass("hidden")}function updateContentLesson(){$("#sandbox .answer-highlight").addClass("hidden-highlight"),content_highlight_lesson=$("#sandbox").html(),$.ajax({type:"POST",url:ajaxUpdateContentLessonReading,dataType:"json",data:{content_highlight_lesson:content_highlight_lesson,content_lesson_source:content_lesson_source},success:function(e){bootbox.alert({message:"Update lesson success!",backdrop:!0,callback:function(){location.href=baseUrl+"/managerReadingLesson"}})},error:function(e){bootbox.alert({message:"Update lesson fail!",backdrop:!0})}})}function stepEditContentLesson(){$(".edit-highlight").toggleClass("hidden"),$(".edit-content").toggleClass("hidden")}function editQuizLesson(){$(".edit-content-lesson").remove(),$(".preview-lesson").addClass("hidden"),$(".edit-quiz-lesson").removeClass("hidden"),$(".btn-edit-content-lesson").addClass("hidden-class"),$(".btn-edit-quiz-lesson").addClass("hidden-class"),$("#sandbox-quiz .answer-highlight").removeClass("hidden-highlight"),$("#solution-area .question-quiz").each(function(){var e=$(this).data("qnumber");-1==jQuery.inArray(e,listAnswer_source)&&(listAnswer_source[e]=$(".explain-area-"+e+" .key-answer").html(),listKeyword_source[e]=$("#explain-"+e+" .explanation").html(),"No_keywords"==listKeyword_source[e]?(listClassKeyword[e]="hidden-class",listKeyword_source[e]=""):listClassKeyword[e]="",-1==jQuery.inArray(e,list_Q_old)&&list_Q_old.push(e))})}function checkStepQuiz(){return""!=CKEDITOR.instances.quizLesson.getData()||(bootbox.alert({message:"Please enter the content of quiz!",backdrop:!0}),!1)}function checkStepAnswer(){return listAnswer={},listKeyword={},list_type_questions={},$(".preview-content-quiz .card-block .last-option").each(function(){var e=$(this).data("qnumber"),t=$(this).attr("name");t=t.match(/\d+/);var s=$(".answer-"+t).val().trim(),n=CKEDITOR.instances["input_explanation_"+e].getData();""!=s?listAnswer[e]=s:delete listAnswer[e],""==n?(n="No_keywords",listClassKeyword[e]="hidden-class"):listClassKeyword[e]="",listKeyword[e]=n,list_type_questions[e]=type_question_id}),listQ.length==Object.keys(listAnswer).length&&listQ.length==Object.keys(list_type_questions).length}var baseUrl=document.location.origin,mainUrl=baseUrl.substring(13),content_lesson_source="",lesson_id=$(".upload-page-custom").data("lesson-id"),quiz_id=$(".upload-page-custom").data("quiz-id"),ajaxUpdateContentLessonReading=baseUrl+"/updateContentLessonReading/1-"+lesson_id,content_highlight_lesson="",content_highlight="",type_question_id=0,content_quiz="",listQ=[],content_answer_quiz="",listClassKeyword={},listAnswer={},listKeyword={},list_type_questions={},listAnswer_source={},listKeyword_source={},list_type_questions_source={},ajaxUpdateQuizReadingReading=baseUrl+"/updateQuizReading/1-"+lesson_id,list_Q_old=[];$(document).ready(function(){$(".btn-next-edit-answer").click(function(){checkStepQuiz()&&(content_quiz!=CKEDITOR.instances.quizLesson.getData()&&(content_quiz=CKEDITOR.instances.quizLesson.getData(),$(".preview-content-quiz .card-block").html(content_quiz),$(".answer-area").html(""),listQ=[],$(".preview-content-quiz .card-block .question-quiz").each(function(){var e=$(this).data("qnumber");if(-1==jQuery.inArray(e,listQ)){listQ.push(e);var t=$(this).attr("name");t=t.match(/\d+/),$(".answer-area").append('<div class="answer-key answer-enter-'+e+'" data-qnumber="'+e+'"><h5 class="title-answer-for-question title-custom">Question '+t+':</h5><div class="enter-answer-key row-enter-custom"><div class="title-row-enter">Answer '+t+': </div><input class="answer-q answer-'+t+'" data-qnumber="'+e+'" /></div><div class="enter-keyword row-enter-custom"><div class="title-row-enter">Explanation '+t+': </div><textarea id="input_explanation_'+e+'" class="input-keyword keyword-'+t+'" data-qnumber="'+e+'"></textarea></div><div class="remove-highlight-area-'+t+'"></div></div>'),CKEDITOR.replace("input_explanation_"+e)}-1==jQuery.inArray(e,listAnswer_source)&&($("input.answer-q[data-qnumber="+e+"]").val(listAnswer_source[e]),""==listKeyword_source[e]||void 0==listKeyword_source[e]||null==listKeyword_source[e]?CKEDITOR.instances["input_explanation_"+e].setData(html_table):CKEDITOR.instances["input_explanation_"+e].setData(listKeyword_source[e]))})),$("#sandbox-quiz .answer-highlight").each(function(){$(this).removeClass("hidden-highlight");var e=$(this)[0].classList[1].match(/\d+/);0==$(".remove-ans-"+e[0]).length&&$(".remove-highlight-area-"+e[0]).append('<div class="remove-ans-'+e[0]+'">Remove highlight for anwser '+e[0]+': <button class="btn btn-info remove" data-removeid="'+e[0]+'">Remove</button></div>')}),listQ.length>0?($(".edit-quiz").toggleClass("hidden"),$(".edit-answer").toggleClass("hidden")):bootbox.alert({message:"Please enter question of quiz!",backdrop:!0}))}),$(".btn-back-edit-quiz").click(function(){$(".edit-quiz").toggleClass("hidden"),$(".edit-answer").toggleClass("hidden")}),$(".btn-next-preview-edit").click(function(){type_question_id=$(".upload-page-custom").data("type-question-id"),checkStepAnswer()?(content_highlight=$("#sandbox-quiz").html(),$(".preview-edit-lesson").toggleClass("hidden"),$(".edit-answer").toggleClass("hidden"),$("#pr-post").html(content_highlight),$(".answer-highlight").addClass("hidden-highlight"),$("#pr-quiz").html(content_quiz),$("#pr-quiz .last-option").each(function(){var e=$(this).data("qnumber"),t=$(this).attr("name");t=t.match(/\d+/);var s=$(".answer-"+t).val();$(this).parent().after('<div class="explain-area explain-'+t+" explain-area-"+e+'" data-qnumber="'+e+'" data-qorder="'+t+'" data-type-question="'+list_type_questions[e]+'"><div class="show-answer"><button type="button" class="btn btn-danger btn-show-answer">Answer '+t+' <div class="badge badge-pill key-answer">'+s+'</div></button><div class="explain-show" id="explain-'+e+'"> <button type="button" class="btn btn-primary btn-show-explanation show-explanation-'+e+'" data-qnumber="'+e+'" data-qorder="'+t+'" data-type-question="'+list_type_questions[e]+'" onclick="showExplanation('+e+","+t+')"><i class="fa fa-key" aria-hidden="true"></i> Explanation</button><div class="hidden explanation">'+listKeyword[e]+"</div></div></div></div>")}),$("#pr-quiz input").each(function(){$(this).attr("disabled","disabled")}),$("#pr-quiz select").each(function(){$(this).attr("disabled","disabled")}),content_answer_quiz=$("#pr-quiz").html(),content_highlight=$("#pr-post").html()):bootbox.alert({message:"Please enter answer of quiz!",backdrop:!0})}),$(".btn-back-edit-answer").click(function(){$(".answer-highlight").removeClass("hidden-highlight"),$(".answer-highlight").removeClass("highlighting"),$(".preview-edit-lesson").toggleClass("hidden"),$(".edit-answer").toggleClass("hidden")}),$(".btn-update-quiz-lesson").click(function(){$.ajax({type:"POST",url:ajaxUpdateQuizReadingReading,dataType:"json",data:{list_Q_old:list_Q_old,list_answer:listAnswer,content_highlight:content_highlight,content_quiz:content_quiz,content_answer_quiz:content_answer_quiz,type_question_id:type_question_id,listKeyword:listKeyword},success:function(e){bootbox.alert({message:"Update quiz success!",backdrop:!0,callback:function(){location.href=baseUrl+"/managerReadingLesson"}})},error:function(e){bootbox.alert({message:"Update quiz fail!",backdrop:!0})}})})}),$(document).on("change","input.answer-q",function(){var e=$(this).data("qnumber");listAnswer_source[e]=$(this).val()}),$(document).on("change",".input-keyword",function(){var e=$(this).data("qnumber");listKeyword_source[e]=CKEDITOR.instances["input_explanation_"+e].getData(),""==listKeyword_source[e]?listClassKeyword[e]="hidden-class":listClassKeyword[e]=""}),$(document).on("change",".enter-type-question select",function(){var e=$(this).data("qnumber");list_type_questions_source[e]=$(this).val()});