var content_post="",content_highlight="",content_quiz="",content_answer_quiz="",limit_time=0,level_user_id=0,level_lesson_id=0,order_lesson=0,order_paragraph=0,type_question="",type_question_options="",type_lesson=1,title_post="",img_url="",img_name="",img_name_no_ext="",img_extension="",listQ=[],listAnswer={},listKeyword={},list_type_questions={},listClassKeyword={},listAnswer_source={},listKeyword_source={},list_type_questions_source={},type_question_id="",i="",idremove="",listHl=[],noti=!1,sandbox=document.getElementById("sandbox"),boolRemove=!1,isFinishTest=!1,lesson_id=0,last_lesson_id=$(".upload-new-leson-page").data("last-lesson-id"),type_lesson_id=$(".upload-new-leson-page").data("type-lesson-id"),ajaxUploadFinish=baseUrl+"/createNewReadingLesson/"+type_lesson_id,hltr=new TextHighlighter(sandbox,{onBeforeHighlight:function(e){return i=prompt("Higlight for answer number:",""),console.log("i: "+i),!!i&&(hltr.options.highlightedClass="answer-highlight highlight-"+i,-1==jQuery.inArray(i,listHl)&&listHl.push(i),!0)},onAfterHighlight:function(e,t){var s=$(".answer-"+i).data("qnumber");$(".highlight-"+i).attr("data-qnumber",s);var n="hl-answer-"+s;$(".highlight-"+i).attr("id",n),0==$(".remove-ans-"+i).length&&$(".remove-highlight-area-"+i).append('<div class="remove-ans-'+i+'">Remove highlight for anwser '+i+': <button class="btn btn-info remove" data-removeid="'+i+'">Remove</button></div>')},onRemoveHighlight:function(e){var t="answer-highlight highlight-"+idremove;return e.className==t&&(noti||(boolRemove=window.confirm('Do you really want to remove: "'+e.className+'"'),noti=!0),console.log("bnool: "+boolRemove),boolRemove?($(".remove-ans-"+idremove).remove(),!0):void 0)}});$(document).ready(function(){content_post=CKEDITOR.instances.contentPost.getData(),content_quiz=CKEDITOR.instances.contentQuiz.getData(),$(".btn-next-step-quiz").click(function(){if(4==type_lesson_id){if(lesson_id=$("#list_lesson").val().trim(),title_post=$("#list_lesson option:selected").text().trim(),0==lesson_id)return bootbox.alert({message:"Pls create new full test!",backdrop:!0}),!1}else title_post=$("input#itemname").val();var e=1;if(0==(level_lesson_id=$("#list_level").val().trim()))bootbox.alert({message:"Pls select level lesson!",backdrop:!0});else{if(level_lesson_id=$("#list_level").val().trim(),type_question_id=type_lesson_id<3?$("#list_type_questions").val().trim():$("#list_level").val().trim(),4==type_lesson_id){var t=1,s=baseUrl+"/getAllOrderParagraphOfFullTest/"+lesson_id;$.ajax({type:"GET",url:s,dataType:"json",success:function(e){$("#loading").hide(),$(".list-ordered-paragraph").html(""),isFinishTest=!1,e.all_paragraph_orders.length>=3?isFinishTest=!0:(jQuery.each(e.all_paragraph_orders,function(e,s){$(".list-ordered-paragraph").append("<li>"+s.order_paragraph+"</li>"),t=s.order_paragraph+1}),$("#order_paragraph").val(t))},error:function(e){$("#loading").hide(),bootbox.alert({message:"Get ordered paragraph fail!",backdrop:!0})}})}else{var i=baseUrl+"/getAllOrdered/"+type_lesson_id+"-"+type_question_id;$.ajax({type:"GET",url:i,dataType:"json",success:function(t){$("#loading").hide(),$(".list-ordered").html(""),jQuery.each(t.all_orders,function(t,s){$(".list-ordered").append("<li>"+s.order_lesson+"</li>"),e=s.order_lesson+1}),$("#order_lesson").val(e)},error:function(e){$("#loading").hide(),bootbox.alert({message:"Get ordered fail!",backdrop:!0})}})}checkStepPost()&&($(".step-content-post").addClass("hidden-class"),$(".step-content-quiz").removeClass("hidden-class"))}}),$(".btn-prev-step-post").click(function(){$(".step-content-quiz").addClass("hidden-class"),$(".step-content-post").removeClass("hidden-class")}),$(".btn-next-step-answer").click(function(){level_user_id=$("#list_level_users").val().trim(),order_lesson=$("#order_lesson").val().trim(),limit_time=$("#limit_time").val().trim(),4==type_lesson_id&&(order_paragraph=$("#order_paragraph").val().trim()),checkStepQuiz(level_user_id,order_lesson)&&(content_quiz==CKEDITOR.instances.contentQuiz.getData()&&type_lesson==$("#typeLesson").val()||(content_quiz=CKEDITOR.instances.contentQuiz.getData(),$(".preview-content-quiz .card-block").html(content_quiz),$(".answer-area").html(""),listQ=[],$(".question-quiz").each(function(){var e=$(this).data("qnumber");if(-1==jQuery.inArray(e,listQ)){listQ.push(e);var t=$(this).attr("name");t=t.match(/\d+/),type_lesson_id<3?$(".answer-area").append('<div class="answer-key answer-enter-'+e+'" data-qnumber="'+e+'"><h5 class="title-answer-for-question title-custom">Question '+t+':</h5><div class="enter-answer-key row-enter-custom"><div class="title-row-enter">Answer '+t+': </div><input class="answer-q answer-'+t+'" data-qnumber="'+e+'" /></div><div class="enter-keyword row-enter-custom"><div class="title-row-enter">Explanation '+t+': </div><textarea id="input_explanation_'+e+'" class="input-keyword keyword-'+t+'" data-qnumber="'+e+'"></textarea></div><div class="remove-highlight-area-'+t+'"></div></div>'):$(".answer-area").append('<div class="answer-key answer-enter-'+e+'" data-qnumber="'+e+'"><h5 class="title-answer-for-question title-custom">Question '+t+':</h5><div class="enter-answer-key row-enter-custom"><div class="title-row-enter">Answer '+t+': </div><input class="answer-q answer-'+t+'" data-qnumber="'+e+'" /></div><div class="enter-keyword row-enter-custom"><div class="title-row-enter">Explanation '+t+': </div><textarea id="input_explanation_'+e+'" class="input-keyword keyword-'+t+'" data-qnumber="'+e+'"></textarea></div><div class="enter-type-question row-enter-custom"><label for="select-type-question-'+e+'" data-qnumber="'+e+'"><strong>Ch·ªçn Loai cau hoi</strong></label> <select class="form-control single-type-question sl-type-question-'+t+'" data-qnumber="'+e+'" name="select-type-question-'+e+'"> '+type_question_options+'</select></div><div class="remove-highlight-area-'+t+'"></div></div>'),CKEDITOR.replace("input_explanation_"+e)}-1==jQuery.inArray(e,listAnswer_source)&&($("input.answer-q[data-qnumber="+e+"]").val(listAnswer_source[e]),""==listKeyword_source[e]||void 0==listKeyword_source[e]||null==listKeyword_source[e]?CKEDITOR.instances["input_explanation_"+e].setData(html_table):CKEDITOR.instances["input_explanation_"+e].setData(listKeyword_source[e]),$(".enter-type-question select[data-qnumber="+e+"]").val(list_type_questions_source[e]))})),listQ.length>0?($(".step-content-quiz").addClass("hidden-class"),$(".step-answer-key").removeClass("hidden-class")):bootbox.alert({message:"Please enter question of quiz!",backdrop:!0}),content_post!=CKEDITOR.instances.contentPost.getData()&&(content_post=CKEDITOR.instances.contentPost.getData(),$(".remove-highlight-area").html(""),$("#sandbox").html(content_post)))}),$(".btn-prev-step-quiz").click(function(){$(".step-content-quiz").removeClass("hidden-class"),$(".step-answer-key").addClass("hidden-class")}),$(".btn-prev-step-answer").click(function(){$(".step-answer-key").removeClass("hidden-class"),$(".step-preview-post").addClass("hidden-class"),$(".answer-highlight").removeClass("hidden-highlight"),$(".answer-highlight").removeClass("highlighting"),$("#pr-post").html(""),$("#pr-quiz").html("")}),$(".btn-next-step-preview").click(function(){checkStepAnswer()?(content_highlight=$("#sandbox").html(),$(".step-preview-post").removeClass("hidden-class"),$(".step-answer-key").addClass("hidden-class"),$("#pr-post").html(content_highlight),$(".answer-highlight").addClass("hidden-highlight"),$("#pr-quiz").html(content_quiz),$("#pr-quiz .last-option").each(function(){var e=$(this).data("qnumber"),t=$(this).attr("name");t=t.match(/\d+/);var s=$(".answer-"+t).val();$(this).parent().after('<div class="explain-area explain-'+t+" explain-area-"+e+'" data-qnumber="'+e+'" data-qorder="'+t+'" data-type-question="'+list_type_questions[e]+'"><div class="show-answer"><button type="button" class="btn btn-danger btn-show-answer">Answer '+t+' <div class="badge badge-pill key-answer">'+s+'</div></button><div class="explain-show" id="explain-'+e+'"> <button type="button" class="btn btn-primary btn-show-explanation show-explanation-'+e+'" data-qnumber="'+e+'" data-qorder="'+t+'" data-type-question="'+list_type_questions[e]+'" onclick="showExplanation('+e+","+t+')"><i class="fa fa-key" aria-hidden="true"></i> Explanation</button><div class="hidden explanation">'+listKeyword[e]+"</div></div></div></div>")}),$("#pr-quiz input").each(function(){$(this).attr("disabled","disabled")}),$("#pr-quiz select").each(function(){$(this).attr("disabled","disabled")}),content_answer_quiz=$("#pr-quiz").html(),content_highlight=$("#pr-post").html()):bootbox.alert({message:"Please enter answer of quiz!",backdrop:!0})}),$(".btn-finish-steps").click(function(){$("#loading").show(),$.ajax({type:"POST",url:ajaxUploadFinish,dataType:"json",data:{lesson_id:lesson_id,order_paragraph:order_paragraph,level_lesson_id:level_lesson_id,level_user_id:level_user_id,order_lesson:order_lesson,type_question_id:type_question_id,img_url:img_url,img_name_no_ext:img_name_no_ext,img_extension:img_extension,title_post:title_post,list_answer:listAnswer,content_post:content_post,content_highlight:content_highlight,content_quiz:content_quiz,content_answer_quiz:content_answer_quiz,list_type_questions:list_type_questions,listKeyword:listKeyword,limit_time:limit_time},success:function(e){$("#loading").hide(),"fail-order"==e.result?4==type_lesson_id?bootbox.alert({message:"Order paragraph is not available!",backdrop:!0}):bootbox.alert({message:"Order lesson is not available!",backdrop:!0}):bootbox.alert({message:"Create new lesson success!",backdrop:!0,callback:function(){location.href=baseUrl+"/createNewReadingLesson/"+type_lesson_id}})},error:function(e){$("#loading").hide(),bootbox.alert({message:"Create practice lesson fail!",backdrop:!0})}})})}),$(document).on("click",".remove",function(){idremove=$(this).data("removeid"),noti=!1,hltr.removeHighlights()});